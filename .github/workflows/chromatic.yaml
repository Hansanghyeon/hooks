name: chromatic-deployment

# pathë¥¼ ì„¤ì •í•´ë„ë˜ëŠ”ì´ìœ  github branchì˜µì…˜ì—ì„œ ghaì˜ ì´ë¦„ë§Œ ì„ íƒí•´ì„œ ì„ íƒí•œ ì´ë¦„ ëª¨ë‘ê°€ í†µê³¼í•˜ë©´ mergeí•  ìˆ˜ ìˆê²Œí•œë‹¤ë©´ ëª¨ë“  ì†ŒìŠ¤ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸í•˜ì§€ ì•Šì•„ë„ëœë‹¤.
on:
  push:
    paths:
      - "src/**/*"
      - ".github/workflows/chromatic.yaml"
  workflow_dispatch:

# List of jobs
jobs:
  deployment:
    name: chromatic-deployment
    # Operating System
    runs-on: hyeon
    # Job steps
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0 # ğŸ‘ˆ Required to retrieve git history
      # ===============================
      # self-host runnerë¡œí•˜ë©´ì„œ ìƒê¸´ step
      # í”„ë¡œë•ì…˜ìœ¼ë¡œ ì˜®ê¸°ë©´ ì œê±°í•´ì•¼í•¨
      # ===============================
      - name: Installing NodeJS
        uses: actions/setup-node@v3
        with:
          node-version: 18
      - name: global install yarn
        run: npm install -g yarn
      # ===============================
      # self-host runnerë¡œí•˜ë©´ì„œ ìƒê¸´ step
      # í”„ë¡œë•ì…˜ìœ¼ë¡œ ì˜®ê¸°ë©´ ì œê±°í•´ì•¼í•¨
      # ===============================
      - name: Install dependencies & build
        # ğŸ‘‡ Install dependencies with the same package manager used in the project (replace it as needed), e.g., yarn, npm, pnpm
        run: |
          yarn
          yarn build-storybook
        # env:
        #   ENV: ${{ secrets.env }}
        # ğŸ‘‡ Adds Chromatic as a step in the workflow
      - name: Publish Project react-components to Chromatic
        uses: chromaui/action@v1
        # Chromatic GitHub Action options
        with:
          # ğŸ‘‡ Chromatic projectToken, refer to the manage page to obtain it.
          projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
          # jobsì˜ defaultë¡œ workdirë¥¼ ë³€ê²½í•´ì„œ ì‘ë™í•˜ëŠ” ê²ƒì€ ì•ˆëœë‹¤. pathì˜¤ë¥˜ê°€ìˆìŒ
          storybookBuildDir: ./storybook-static
